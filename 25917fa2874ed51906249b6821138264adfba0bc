{
  "comments": [
    {
      "key": {
        "uuid": "d3e2706d_c30afc7a",
        "filename": "/COMMIT_MSG",
        "patchSetId": 2
      },
      "lineNbr": 7,
      "author": {
        "id": 1373864
      },
      "writtenOn": "2020-06-17T15:13:56Z",
      "side": 1,
      "message": "I\u0027m trying to understand the implications of this. Does it mean that libdexfile_support, libdexfile_external and all its dependencies are compiled for the host (read x86) arch and end up somewhere in /system/lib? And that is besides the ordinary libs in /system/apex/com.android.art/lib?\n\nIf so, there could be a potential for ODR violations between the two sets of libs?",
      "range": {
        "startLine": 7,
        "startChar": 24,
        "endLine": 7,
        "endChar": 51
      },
      "revId": "25917fa2874ed51906249b6821138264adfba0bc",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "9e8affea_5c749262",
        "filename": "/COMMIT_MSG",
        "patchSetId": 2
      },
      "lineNbr": 7,
      "author": {
        "id": 1069991
      },
      "writtenOn": "2020-06-17T16:20:43Z",
      "side": 1,
      "message": "No. \"native_bridge_supported: true\" allows soong to build library for guest architecture (arm usually), not for native architecture (x86).\n\nNative x86 libraries are untouched in that scenario.\n\nThis is done that way because out of hundreds of libraries and programs compiled natively only a handful need native_bridge version (mostly public ones exposed in NDK).\n\nRenderScript needs about 40 different libraies from 20 different projects, though.",
      "parentUuid": "d3e2706d_c30afc7a",
      "range": {
        "startLine": 7,
        "startChar": 24,
        "endLine": 7,
        "endChar": 51
      },
      "revId": "25917fa2874ed51906249b6821138264adfba0bc",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "fbcdaf05_feb3659e",
        "filename": "/COMMIT_MSG",
        "patchSetId": 2
      },
      "lineNbr": 7,
      "author": {
        "id": 1373864
      },
      "writtenOn": "2020-06-17T19:16:52Z",
      "side": 1,
      "message": "Thanks for the clarifications. It still means that all these libraries end up in /system/lib, in addition to their normal instances in /apex/com.android.art?\n\nI assume APEX updatability still isn\u0027t a factor for native_bridge use cases. Even so, if the above is correct then it\u0027s a setup I doubt we\u0027d be able to support. One reason is the different linker namespace configuration, another is the risk of ODR issues.\n\nWould it be possible to bridge the native ABI from libdexfile_external.so to the guest and use native_bridge_supported on libdexfile_support only? It\u0027s a C interface that is fairly small: https://cs.android.com/android/platform/superproject/+/master:art/libdexfile/external/include/art_api/dex_file_external.h\n\nI might also mention that it\u0027s easy to create a dummy libdexfile_support that does nothing and depends on nothing (-DNO_DEXFILE_SUPPORT), as a stop-gap fix to decouple this from the rest.",
      "parentUuid": "9e8affea_5c749262",
      "range": {
        "startLine": 7,
        "startChar": 24,
        "endLine": 7,
        "endChar": 51
      },
      "revId": "25917fa2874ed51906249b6821138264adfba0bc",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "e16f644d_362cbe60",
        "filename": "libartbase/Android.bp",
        "patchSetId": 2
      },
      "lineNbr": 27,
      "author": {
        "id": 1373864
      },
      "writtenOn": "2020-06-17T15:13:56Z",
      "side": 1,
      "message": "This happens when renderscript is retired, or some other condition?",
      "range": {
        "startLine": 27,
        "startChar": 26,
        "endLine": 27,
        "endChar": 55
      },
      "revId": "25917fa2874ed51906249b6821138264adfba0bc",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c53cc36b_6ee743c0",
        "filename": "libartbase/Android.bp",
        "patchSetId": 2
      },
      "lineNbr": 27,
      "author": {
        "id": 1069991
      },
      "writtenOn": "2020-06-17T16:20:43Z",
      "side": 1,
      "message": "Yes, this could be removed when renderscript is removed.\n\nIn theory we may try to introduce \"proxy\" library which would redirect work from arm library to x86 library.\n\nWe try to avoid that if possible, though: marshalling function calls between two architectures is not easy.",
      "parentUuid": "e16f644d_362cbe60",
      "range": {
        "startLine": 27,
        "startChar": 26,
        "endLine": 27,
        "endChar": 55
      },
      "revId": "25917fa2874ed51906249b6821138264adfba0bc",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    }
  ]
}
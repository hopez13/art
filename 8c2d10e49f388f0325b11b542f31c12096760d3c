{
  "comments": [
    {
      "key": {
        "uuid": "1583872a_c2f94470",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1308278
      },
      "writtenOn": "2020-07-08T12:10:12Z",
      "side": 1,
      "message": "I am interested in how Integer.divideUnsigned is used. Could you share this information?\nMaybe, instead of the intrinsic, it is worth to replace the call with HDiv(UInt32 dividend, UInt32 divisor). If the divisor is a constant, more effective code is generated.",
      "revId": "8c2d10e49f388f0325b11b542f31c12096760d3c",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "e3074c57_966f4c38",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1308278
      },
      "writtenOn": "2020-07-08T12:18:56Z",
      "side": 1,
      "message": "Out of curiosity, is Integer.divideUnsigned inlined?\nI\u0027ve been working on recognition of non-negative dividends. If everything is inlined, it is not difficult to detect that dividend and divisor are non-negative.\nThere is \u0027IsGEZero(HInstruction* instruction)\u0027 where the logic can be added.",
      "parentUuid": "1583872a_c2f94470",
      "revId": "8c2d10e49f388f0325b11b542f31c12096760d3c",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c075a6a3_025a001b",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1071150
      },
      "writtenOn": "2020-07-08T12:47:08Z",
      "side": 1,
      "message": "Hi Evgeny, this work is motivated by:\n\n  https://issuetracker.google.com/issues/154693569\n\nwhich in turn probably comes from:\n\n  https://jakewharton.com/which-is-better-on-android-divide-by-two-or-shift-by-one/ \n\nWe\u0027re using it as a warm-up project for Andra\u0027s internship.\n\nWe debated whether to replace with HDiv or implement as an an instrinsic, but we felt instrinsic was probably sufficient and low risk: existing code might be surprised by unsigned types.\n\nThere isn\u0027t widespread usage of Integer.divideUnsigned() (or Long.divideUnsigned()). AFAIK, the only actual usage on Android is with openjdk\u0027s java.util.stream.LongStream.\n\nNot averse to a future change taking the direction you are suggesting.",
      "parentUuid": "e3074c57_966f4c38",
      "revId": "8c2d10e49f388f0325b11b542f31c12096760d3c",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ca6e9f27_74894a76",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1725700
      },
      "writtenOn": "2020-07-08T13:08:32Z",
      "side": 1,
      "message": "Hi! Replacing the HInvoke node with a HDiv node was my first approach, but unfortunately it is not possible because the node uses the \"idiv\" instruction for code generation, which is signed division. To make this possible, a new node (HUDiv) or a flag that signals the division as being unsigned would have been necessary. That would have implied a lot of other changes. Making the intrinsic in the code generation part of the compiler to just replace the call with a div was an easier choice.",
      "parentUuid": "e3074c57_966f4c38",
      "revId": "8c2d10e49f388f0325b11b542f31c12096760d3c",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "9b5eb4be_72a5fa26",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1308278
      },
      "writtenOn": "2020-07-08T13:25:17Z",
      "side": 1,
      "message": "Hi Orion,\n\nThank you for the links. I have recently significantly improved ARM32/ARM64 code generation when a divisor is a constant. This includes unsigned div/rem cases. The x86/x86_64 code generation does not have them. I don\u0027t mind to have the intrinsic. I can add support of it to ARM32/ARM64. Should I do this?\nBTW, the author of the blog post has a common misconception about that \u0027a / 2\u0027 is the same as \u0027v \u003e\u003e 1\u0027. This is only true for unsigned types.",
      "parentUuid": "c075a6a3_025a001b",
      "revId": "8c2d10e49f388f0325b11b542f31c12096760d3c",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "47338267_044cdc55",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1308278
      },
      "writtenOn": "2020-07-08T13:35:02Z",
      "side": 1,
      "message": "Yes, the intrinsic base solution is simpler.\nHas anyone analyzed why the method is not inlined?",
      "parentUuid": "9b5eb4be_72a5fa26",
      "revId": "8c2d10e49f388f0325b11b542f31c12096760d3c",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "8a685d6f_51cf7f9f",
        "filename": "runtime/image.cc",
        "patchSetId": 2
      },
      "lineNbr": 32,
      "author": {
        "id": 1018108
      },
      "writtenOn": "2020-07-08T13:05:02Z",
      "side": 1,
      "message": "Change the tag. (For example \"Integer.divideUnsigned\" if it fits on the line.)",
      "range": {
        "startLine": 32,
        "startChar": 74,
        "endLine": 32,
        "endChar": 87
      },
      "revId": "8c2d10e49f388f0325b11b542f31c12096760d3c",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "ec6cc442_51e007c9",
        "filename": "runtime/image.cc",
        "patchSetId": 2
      },
      "lineNbr": 32,
      "author": {
        "id": 1725700
      },
      "writtenOn": "2020-07-08T13:25:25Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "8a685d6f_51cf7f9f",
      "range": {
        "startLine": 32,
        "startChar": 74,
        "endLine": 32,
        "endChar": 87
      },
      "revId": "8c2d10e49f388f0325b11b542f31c12096760d3c",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889",
      "unresolved": false
    }
  ]
}
{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "29dba003_ede2e9ff",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 6
      },
      "lineNbr": 0,
      "author": {
        "id": 1258954
      },
      "writtenOn": "2020-08-28T22:08:55Z",
      "side": 1,
      "message": "Carmen, this is the final patch (hopefully). Can you please run one more test to confirm that it is working as intended?",
      "revId": "febcea608e8cd08093d76a9f72f8b9433949309a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5be1e92f_bd714b3a",
        "filename": "runtime/gc/heap-inl.h",
        "patchSetId": 6
      },
      "lineNbr": 201,
      "author": {
        "id": 1042828
      },
      "writtenOn": "2020-08-29T00:57:34Z",
      "side": 1,
      "message": "I don\u0027t see a release store for this to pair with. As a result it\u0027s not clear it does anything.",
      "range": {
        "startLine": 201,
        "startChar": 48,
        "endLine": 201,
        "endChar": 73
      },
      "revId": "febcea608e8cd08093d76a9f72f8b9433949309a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1cd89507_0abc080f",
        "filename": "runtime/gc/heap-inl.h",
        "patchSetId": 6
      },
      "lineNbr": 201,
      "author": {
        "id": 1258954
      },
      "writtenOn": "2020-08-31T20:16:29Z",
      "side": 1,
      "message": "I thought \u0027acquire\u0027 ensures that any read or write to another memory location doesn\u0027t get reordered above this load, no? The idea here is to ensure that the load of num_bytes_allocated_ below doesn\u0027t get reordered with this load.\n\nNow that you mentioned it, I have to relook if replacing the relaxed store to last_reported_heap_size_ by GC thread in GrowForUtilization() by an release store can help remove the re-load of num_bytes_allocated_ below.",
      "parentUuid": "5be1e92f_bd714b3a",
      "range": {
        "startLine": 201,
        "startChar": 48,
        "endLine": 201,
        "endChar": 73
      },
      "revId": "febcea608e8cd08093d76a9f72f8b9433949309a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d63f1255_71b89879",
        "filename": "runtime/gc/heap-inl.h",
        "patchSetId": 6
      },
      "lineNbr": 201,
      "author": {
        "id": 1042828
      },
      "writtenOn": "2020-09-23T22:35:46Z",
      "side": 1,
      "message": "I think I see.  So we want to make sure that if GrowForUtilization() updates last_reported_heap_size and we see that update here, then we also see the corresponding decrement of num_bytes_allocated? Can we say that in a comment here? Then the comment in GrowForUtilization could say the same or refer to this one.\n\nWe presumably still have the inverse problem, in which we see the reduced num_bytes_allocated, but don\u0027t see the last_reported_heap_size_ update. I think in that case we can still fail to report a large allocation. Though I guess that should fix itself at the next allocation, and thus is probably OK?",
      "parentUuid": "1cd89507_0abc080f",
      "range": {
        "startLine": 201,
        "startChar": 48,
        "endLine": 201,
        "endChar": 73
      },
      "revId": "febcea608e8cd08093d76a9f72f8b9433949309a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "8236f36e_87acceea",
        "filename": "runtime/gc/heap-inl.h",
        "patchSetId": 6
      },
      "lineNbr": 201,
      "author": {
        "id": 1258954
      },
      "writtenOn": "2023-11-09T18:08:42Z",
      "side": 1,
      "message": "\u0027Yes\u0027 to both your questions.\n\nFor your last question: we just skip updating last_reported_heap_size_ and instead wait for gc-thread to update it. In case if gc-thread happens to update it with num_bytes_allocated before it was added into, then eventually the next allocation will make value consistent.",
      "parentUuid": "d63f1255_71b89879",
      "range": {
        "startLine": 201,
        "startChar": 48,
        "endLine": 201,
        "endChar": 73
      },
      "revId": "febcea608e8cd08093d76a9f72f8b9433949309a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d9c2d558_91509286",
        "filename": "runtime/gc/heap-inl.h",
        "patchSetId": 6
      },
      "lineNbr": 229,
      "author": {
        "id": 1042828
      },
      "writtenOn": "2020-08-29T00:57:34Z",
      "side": 1,
      "message": "I don\u0027t see that argument.",
      "range": {
        "startLine": 228,
        "startChar": 17,
        "endLine": 229,
        "endChar": 28
      },
      "revId": "febcea608e8cd08093d76a9f72f8b9433949309a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "8bc5dcc2_31351f25",
        "filename": "runtime/gc/heap-inl.h",
        "patchSetId": 6
      },
      "lineNbr": 229,
      "author": {
        "id": 1258954
      },
      "writtenOn": "2020-08-31T20:16:29Z",
      "side": 1,
      "message": "I didn\u0027t get what you mean?\n\nThe execution will reach here if the GC thread stores to last_reported_heap_size_, while this thread is trying the CAS in this loop. And when this happens, it is guaranteed that this allocation is already taken into consideration by the GC thread.",
      "parentUuid": "d9c2d558_91509286",
      "range": {
        "startLine": 228,
        "startChar": 17,
        "endLine": 229,
        "endChar": 28
      },
      "revId": "febcea608e8cd08093d76a9f72f8b9433949309a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c0448784_e3c02715",
        "filename": "runtime/gc/heap-inl.h",
        "patchSetId": 6
      },
      "lineNbr": 229,
      "author": {
        "id": 1042828
      },
      "writtenOn": "2020-09-23T22:35:46Z",
      "side": 1,
      "message": "Can you expand on \"And when this happens, it is guaranteed that this allocation is already taken into consideration by the GC thread.\"?\n\nWe\u0027ve updated num_bytes_allocated. Why can\u0027t GrowForUtilization() have read the heap size before we updated it?",
      "parentUuid": "8bc5dcc2_31351f25",
      "range": {
        "startLine": 228,
        "startChar": 17,
        "endLine": 229,
        "endChar": 28
      },
      "revId": "febcea608e8cd08093d76a9f72f8b9433949309a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "444db466_150a494f",
        "filename": "runtime/gc/heap-inl.h",
        "patchSetId": 6
      },
      "lineNbr": 229,
      "author": {
        "id": 1258954
      },
      "writtenOn": "2023-11-09T18:08:42Z",
      "side": 1,
      "message": "That can certainly happen, but will fail the while loop\u0027s condition itself and hence we won\u0027t even attempt the CAS.",
      "parentUuid": "c0448784_e3c02715",
      "range": {
        "startLine": 228,
        "startChar": 17,
        "endLine": 229,
        "endChar": 28
      },
      "revId": "febcea608e8cd08093d76a9f72f8b9433949309a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "4352ab0d_eb423362",
        "filename": "runtime/gc/heap.h",
        "patchSetId": 6
      },
      "lineNbr": 925,
      "author": {
        "id": 1042828
      },
      "writtenOn": "2020-08-29T00:57:34Z",
      "side": 1,
      "message": "Is there a reason we need to add this, rather than using ATraceEnabled() directly? Especially since it seems to add an out-of-line function call?",
      "range": {
        "startLine": 925,
        "startChar": 2,
        "endLine": 925,
        "endChar": 22
      },
      "revId": "febcea608e8cd08093d76a9f72f8b9433949309a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a19429ff_493a3719",
        "filename": "runtime/gc/heap.h",
        "patchSetId": 6
      },
      "lineNbr": 925,
      "author": {
        "id": 1258954
      },
      "writtenOn": "2020-08-31T20:16:29Z",
      "side": 1,
      "message": "I had to because using ATraceEnabled() directly in heap-inl.h was giving compile time error even after including the right header file.",
      "parentUuid": "4352ab0d_eb423362",
      "range": {
        "startLine": 925,
        "startChar": 2,
        "endLine": 925,
        "endChar": 22
      },
      "revId": "febcea608e8cd08093d76a9f72f8b9433949309a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "d0771c01_86f67847",
        "filename": "runtime/gc/heap.h",
        "patchSetId": 6
      },
      "lineNbr": 925,
      "author": {
        "id": 1042828
      },
      "writtenOn": "2020-09-23T22:35:46Z",
      "side": 1,
      "message": "Weird. That wasn\u0027t otherwise fixable? No big deal.",
      "parentUuid": "a19429ff_493a3719",
      "range": {
        "startLine": 925,
        "startChar": 2,
        "endLine": 925,
        "endChar": 22
      },
      "revId": "febcea608e8cd08093d76a9f72f8b9433949309a",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}